<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>Agent Locker</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #1e1e1e;
        color: white;
        margin: 20px;
        user-select: none; /* verhindert das Auswählen beim Ziehen */
      }

      #draggableContainer {
        width: 320px;
        padding: 15px;
        background: #2c2c2c;
        border-radius: 12px;
        position: absolute; /* wichtig für Drag */
        top: 20px;
        left: 20px;
        cursor: grab;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        -webkit-app-region: drag;
      }

      h2 {
        margin-bottom: 10px;
      }

      #agentButtons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
      }

      button {
        padding: 10px 15px;
        border: none;
        border-radius: 8px;
        background: #444;
        color: white;
        cursor: pointer;
        transition: background 0.2s ease, transform 0.2s ease;
        user-select: none;
        -webkit-app-region: no-drag;
      }

      button:hover {
        background: #666;
        transform: scale(1.05);
      }

      button.active {
        background: #888 !important;
      }

      #lockButton {
        background: linear-gradient(135deg, #ff416c, #ff4b2b);
        color: white;
        font-weight: bold;
        font-size: 1.1em;
        padding: 12px 20px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(255, 65, 108, 0.5);
        transition: background 0.3s ease, box-shadow 0.3s ease,
          transform 0.2s ease;
      }

      #lockButton:hover {
        background: linear-gradient(135deg, #ff4b2b, #ff416c);
        box-shadow: 0 0 20px rgba(255, 75, 43, 0.7);
        transform: scale(1.05);
      }

      #lockButton:disabled {
        background: #666 !important;
        box-shadow: none;
        cursor: not-allowed;
        transform: none;
        opacity: 0.6;
      }

      #status {
        margin-top: 20px;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div id="draggableContainer">
      <h2>Wähle einen Agent:</h2>
      <div id="agentButtons"></div>
      <button id="lockButton">🔒 Lock</button>
      <button id="abbrechenButton">Abrechen</button>
      <p id="status">Bereit...</p>
    </div>

    <script>
      const agents = [
        { brimstone: "9f0d8ba9-4140-b941-57d3-a7ad57c6b417" },
        { phoenix: "eb93336a-449b-9c1b-0a54-a891f7921d69" },
        { sage: "569fdd95-4d10-43ab-ca70-79becc718b46" },
        { sova: "320b2a48-4d9b-a075-30f1-1f93a9b638fa" },
        { viper: "707eab51-4836-f488-046a-cda6bf494859" },
        { cypher: "117ed9e3-49f3-6512-3ccf-0cada7e3823b" },
        { reyna: "a3bfb853-43b2-7238-a4f1-ad90e9e46bcc" },
        { killjoy: "1e58de9c-4950-5125-93e9-a0aee9f98746" },
        { breach: "5f8d3a7f-467b-97f3-062c-13acf203c006" },
        { gekko: "e370fa57-4757-3604-3648-499e1f642d3f" },
        { jett: "add6443a-41bd-e414-f6ad-e58d267f4e95" },
        { raze: "f94c3b30-42be-e959-889c-5aa313dba261" },
        { skye: "6f2a04ca-43e0-be17-7f36-b3908627744d" },
        { yoru: "7f94d92c-4234-0a36-9646-3a87eb8b5c89" },
        { astra: "41fb69c1-4189-7b37-f117-bcaf1e96f1bf" },
        { kayo: "601dbbe7-43ce-be57-2a40-4abd24953621" },
        { chamber: "22697a3d-45bf-8dd7-4fec-84a9e28c69d7" },
        { neon: "bb2a4828-46eb-8cd1-e765-15848195d751" },
        { fade: "dade69b4-4f5a-8528-247b-219e5a1facd6" },
        { harbor: "95b78ed7-4637-86d9-7e41-71ba8c293152" },
        { omen: "8e253930-4c05-31dd-1b6c-968525494517" },
        { deadlock: "cc8b64c8-4b25-4ff9-6e7f-37b4da43d235" },
        { iso: "0e38b510-41a8-5780-5e8f-568b2a4f2d6c" },
        { clove: "1dbf2edd-4729-0984-3115-daa5eed44993" },
        { vyse: "efba5359-4016-a1e5-7626-b1ae76895940" },
        { tejo: "b444168c-4e35-8076-db47-ef9bf368f384" },
        { waylay: "df1cb487-4902-002e-5c17-d28e83e78588" }
      ];

      const agentButtons = document.getElementById("agentButtons");
      const lockButton = document.getElementById("lockButton");
      const abbrechenButton = document.getElementById("abbrechenButton");
      const statusEl = document.getElementById("status");

      abbrechenButton.disabled = true;
      let activeButton = null;
      let selectedAgentId = null;
      let selectedAgentName = null;

      agents.forEach((agentObj) => {
        const agentName = Object.keys(agentObj)[0];
        const agentId = agentObj[agentName];

        const btn = document.createElement("button");
        btn.textContent =
          agentName.charAt(0).toUpperCase() + agentName.slice(1);

        btn.onclick = () => {
          if (activeButton) activeButton.classList.remove("active");
          btn.classList.add("active");
          activeButton = btn;

          selectedAgentId = agentId;
          selectedAgentName = agentName;

          console.log(`Agent ausgewählt: ${agentName} (${agentId})`);
          statusEl.textContent = `🕒 Bereit zum Locken: ${agentName}`;
        };

        agentButtons.appendChild(btn);
      });

      lockButton.onclick = () => {
        if (!selectedAgentId) {
          statusEl.textContent = "⚠️ Bitte wähle zuerst einen Agent!";
          return;
        }

        lockButton.disabled = true;
        abbrechenButton.disabled = false;

        console.log(
          `Lock-Vorgang gestartet für: ${selectedAgentName} (${selectedAgentId})`
        );
        statusEl.textContent = `🔒 ${selectedAgentName} wird gelockt...`;
        window.electronAPI.lockAgent(selectedAgentId);
      };

      abbrechenButton.onclick = () => {
        window.electronAPI.cancelLock();
        abbrechenButton.disabled = true;
      }

      window.electronAPI.onCancelSuccess(() => {
        abbrechenButton.disabled = true;
        lockButton.disabled = false;
      })

      window.electronAPI.onLockSuccess(() => {
        lockButton.disabled = false;
      });
      window.electronAPI.onStatusUpdate((status) => {
        statusEl.textContent = status;
      });

    </script>
  </body>
</html>
